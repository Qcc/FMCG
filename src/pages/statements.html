<!DOCTYPE html>
<!-- 订货收款 页面 -->
<html>
    <head>
        <meta charset="UTF-8">
        <title>订货收款-快销宝-深圳市沟通科技有限公司</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <!-- <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" /> -->
        <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="../lib/css/layui.css">
      </head>
      <body style="overflow-y: scroll;">
          <div class="layui-tab layui-tab-brief" lay-filter="task" style="margin: 0px;">
            <ul class="layui-tab-title">
              <li class="layui-this">收款单</li>
              <li>核销单</li>
            </ul>
            <div class="layui-tab-content" style="padding: 0px;">
              <!-- 收款单开始 -->
              <div class="layui-tab-item layui-show">
                  <div class="layui-row" style="position: absolute;top: 5px;right: 5px;">
                    <div class="layui-inline">
                      <form class="layui-form" action="">
                        <div class="layui-input-inline select-height">
                          <div class="layui-input-inline">
                            <div class="layui-input-inline" style="margin-right: -5px;">
                              <input type="text" style="height: 30px;" name="number" placeholder="搜索收款单" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-btn-group">
                              <button class="layui-btn layui-btn-primary layui-btn-sm "><i class="layui-icon">&#xe615;</i> </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                      <div class="layui-inline layui-btn-group">
                        <button class="layui-btn layui-btn-sm btnskadd">新增</button>
                        <button class="layui-btn layui-btn-sm btnskdelete">删除</button>
                      </div>
                    
                </div>
                <table class="layui-table" id="skdtb" lay-filter="skdtb"></table>
              </div>
              <!-- 收款单结束 -->
              <!-- 核销单开始 -->
              <div class="layui-tab-item">
                  <div class="layui-row" style="position: absolute;top: 5px;right: 5px;">
                    <div class="layui-inline">
                      <form class="layui-form" action="">
                        <div class="layui-input-inline select-height">
                          <div class="layui-input-inline">
                            <div class="layui-input-inline" style="margin-right: -5px;">
                              <input type="text" style="height: 30px;" name="number" placeholder="搜索核销单" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-btn-group">
                              <button class="layui-btn layui-btn-primary layui-btn-sm "><i class="layui-icon">&#xe615;</i> </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                      <div class="layui-inline layui-btn-group">
                        <button class="layui-btn layui-btn-sm btnhxadd">新增</button>
                        <button class="layui-btn layui-btn-sm btnhxdelete">删除</button>
                      </div>
                </div>
                <table class="layui-table" id="hxdtb" lay-filter="hxdtb"></table>
              </div>
              <!-- 核销单结束 -->
      <!-- 收款单新增开始 -->
      <div  id="skdpanl" style="display: none;">
          <div class="layui-form"  lay-filter="skdform">
            <div class="layui-form-item">
              <label class="layui-form-label">收款类型</label>
              <div class="layui-input-inline">
                <select name="rcpttype">
                  <option value="">请选择收款类型</option>
                  <option value="1">预付款收款</option>
                  <option value="2" selected="">货款收款</option>
                </select>
              </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">收款金额</label>
                <div class="layui-input-inline">
                  <input type="text" name="rcptmoney" autocomplete="off" placeholder="请输入收款金额" class="layui-input">
                </div>
              </div>

              <div class="layui-input-inline">
                  <div class="layui-form-item">
                    <label class="layui-form-label">付款客户</label>
                      <div class="layui-input-inline">
                        <input type="text" placeholder="请选择客户" class="layui-input cusname">
                        <input type="text" name="rcptcustomer" class="cusuid" style="display:none">
                      </div>
                      <div class="layui-inline">
                          <button type="reset" class="layui-btn layui-btn-primary btnaddcus">选择</button>
                      </div>
                  </div>
              </div>

              <div class="layui-form-item layui-form-text">
                  <label class="layui-form-label">收款说明</label>
                  <div class="layui-input-inline">
                      <textarea name="rcptcomment" placeholder="请输入收款说明" class="layui-textarea"></textarea>
                  </div>
              </div>
              
                <div class="layui-form-item">
                    <div class="layui-input-block">
                      <button class="layui-btn layui-btn-primary spreset" >取消</button>
                      <button class="layui-btn" lay-submit lay-filter="addskd"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i>保存</button>
                    </div>
                </div>
          </div>
      </div>
      <!-- 收款单新增结束 -->
      <!-- 核销单新增开始 -->
      <div  id="hxdpanl" style="display: none;">
          <div class="layui-form"  lay-filter="hxdform">
            
            <div class="layui-form-item">
                <label class="layui-form-label">收款金额</label>
                <div class="layui-input-inline">
                  <input type="text" name="odverifmoney" autocomplete="off" placeholder="请输入核销金额" class="layui-input">
                </div>
              </div>

              <div class="layui-input-inline">
                  <div class="layui-form-item">
                    <label class="layui-form-label">订单</label>
                      <div class="layui-input-inline">
                        <input type="text" placeholder="请选择订单" class="layui-input odveriforder">
                        <input type="text" name="odveriforder" class="odveriforderid" style="display:none">
                      </div>
                      <div class="layui-inline">
                          <button type="reset" class="layui-btn layui-btn-primary btnaddorder">选择</button>
                      </div>
                  </div>
              </div>
              
              <div class="layui-input-inline">
                  <div class="layui-form-item">
                    <label class="layui-form-label">收款单</label>
                      <div class="layui-input-inline">
                        <input type="text" placeholder="请选择收款单" class="layui-input odverifreceipt">
                        <input type="text" name="odverifreceipt" class="odverifreceiptid" style="display:none">
                      </div>
                      <div class="layui-inline">
                          <button type="reset" class="layui-btn layui-btn-primary btnaddskd">选择</button>
                      </div>
                  </div>
              </div>

              <div class="layui-form-item layui-form-text">
                  <label class="layui-form-label">核销说明</label>
                  <div class="layui-input-inline">
                      <textarea name="odverifcomment" placeholder="请输入收款说明" class="layui-textarea"></textarea>
                  </div>
              </div>
              
                <div class="layui-form-item">
                    <div class="layui-input-block">
                      <button class="layui-btn layui-btn-primary spreset" >取消</button>
                      <button class="layui-btn" lay-submit lay-filter="addhxd"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i>保存</button>
                    </div>
                </div>
          </div>
      </div>
      <!-- 核销单新增结束 -->
      <!-- 选择客户表 -->
      <div  id="plancus" style="display: none;">
          <table class="layui-table" id="custb" lay-filter="custb"></table>
          <div style="position: relative;right: 20px;text-align: right;">
            <button class="layui-btn  layui-btn-primary cuscancel">取消</button>
            <button  class="layui-btn cusenter">确定</button>
          </div>
      </div>
      <!-- 选择客户结束 -->
      <script type="text/html" id="setting">
        {{#  if(d.rcptstate === 0){ }}
        <a class="layui-btn layui-btn-xs" lay-event="edit" >修改</a>
        <a class="layui-btn layui-btn-xs" lay-event="prover" >审核</a>
        {{#  } else if(d.rcptstate === 1){ }}
        <a class="layui-btn layui-btn-xs layui-btn-disabled" lay-event="edit" >修改</a>
        <a class="layui-btn layui-btn-xs layui-btn-disabled" lay-event="prover" >审核</a>
        {{#  } }}
      </script>
      
      <script type="text/html" id="hxsetting">
        <a class="layui-btn layui-btn-xs" lay-event="edit" >修改</a>
      </script>

      <script type="text/html" id="time">
          {{# var t = layui.admin.formatDateTime(d.rcptdatetime); }}
          <span>{{ t }}</span>
        </script>
      
        <script type="text/html" id="hxtime">
          {{# var t = layui.admin.formatDateTime(d.odverifdatetime); }}
          <span>{{ t }}</span>
        </script>

        <script type="text/html" id="state">
          {{#  if(d.rcptstate === 0){ }}
            <span style="color: #FFB800;">未审核</span>
          {{#  } else if(d.rcptstate === 1){ }}
            <span style="color: #5FB878;">已审核</span>
          {{#  } }}
        </script> 
        
        <script type="text/html" id="type">
          {{#  if(d.rcpttype === 1){ }}
            <span>预付款</span>
          {{#  } else if(d.rcpttype === 2){ }}
            <span>货款</span>
          {{#  } }}
        </script> 
        
        <script type="text/html" id="pprover">
          {{#  if(d.provernickname){ }}
            <span>{{ d.provernickname }}</span>
          {{#  } else { }}
            <span>无</span>
          {{#  } }}
        </script> 
      <script src="../lib/layui.js"></script>
      <!-- <script src="../js/attendance.js"></script> -->
       
      <script>
      layui.config({
      base: '../compontents/' //静态资源所在路径
    }).extend({
      admin: 'admin' //主入口模块
    }).use(['element','form','table','layer','admin'], function(){
    var $ = layui.jquery
    ,element = layui.element
    ,form = layui.form
    ,setter = layui.setter
    ,admin = layui.admin
    ,layer = layui.layer
    ,table = layui.table
    hxd = true; // teb切换防止核销单多次加载标记
    var sessionData = layui.sessionData(setter.tableName);
    var whoami = JSON.parse(sessionData.whoami);
    // var isManager = 
    // 加载全部收款单
    var splan = table.render({
        elem: '#skdtb',
        url: setter.layuiqueryapi,
        method:'post',
        where: 	{jsonparam: JSON.stringify([{
              solve_name_conflict: false,
              model: 'eos_receipt',
              api: 'read',
              columns: ['count(uid) AS total'],
              },{
              model: 'eos_receipt',
              api: 'read',
              columns:['*', 'rcptcustomer$$crm_customer.custmname AS custmname',
                        'rcptuser$$bas_user.nickname AS nickname',
                        'rcptapprover$$bas_user.nickname AS provernickname'
              ],
              association: { 
                rcptcustomer:{},
                rcptuser:{},
                rcptapprover:{}
              },
              order: [ 
               {
                column: "uid",
                order: "DESC", //可选（默认为ASC）
               }
              ],
              // condition:{"simple":{"item1":{"column":"approver","cop":"=","value":admin.iam()}}}
            }])
          },
        cols: [[
            {type:'checkbox'}
            ,{field:'rcptnumber', title: '单号'}
            ,{field:'rcptdatetime', title: '收款时间', sort: true,templet:'#time'}
            ,{field:'rcpttype', title: '收款类型', sort: true,templet:'#type'}
            ,{field:'rcptmoney', title: '收款金额'}
            ,{field:'rcptstate', title: '状态',templet:'#state'}
            ,{field:'rcptcomment', title: '备注'}
            ,{field:'custmname', title: '客户'}
            ,{field:'nickname', title: '收款人'}
            ,{field:'provernickname', title: '审核人',templet:'#pprover'}
            ,{field:'', title: '操作',toolbar: '#setting'}
          ]],
        page: true,
        done: function(res, curr, count){
        }
        });


    // 切换tab页面
  element.on('tab(task)', function(data){
    if(data.index === 1 && hxd){
      // 加载全部核销单
    var splan = table.render({
        elem: '#hxdtb',
        url: setter.layuiqueryapi,
        method:'post',
        where: 	{jsonparam: JSON.stringify([{
              solve_name_conflict: false,
              model: 'eos_order_verificationsheet',
              api: 'read',
              columns: ['count(uid) AS total'],
              },{
              model: 'eos_order_verificationsheet',
              api: 'read',
              columns:['*', 'odveriforder$$eos_order.odnumber AS odnumber',
                        'odverifreceipt$$eos_receipt.rcptnumber AS rcptnumber',
                        'odverifuser$$bas_user.nickname AS nickname'
              ],
              association: { 
                odveriforder:{},
                odverifreceipt:{},
                odverifuser:{}
              },
              order: [ 
               {
                column: "uid",
                order: "DESC", //可选（默认为ASC）
               }
              ],
              // condition:{"simple":{"item1":{"column":"approver","cop":"=","value":admin.iam()}}}
            }])
          },
        cols: [[
            {type:'checkbox'}
            ,{field:'odverifmoney', title: '核销金额'}
            ,{field:'odverifdatetime', title: '核销时间', sort: true,templet:'#hxtime'}
            ,{field:'odnumber', title: '订单号'}
            ,{field:'rcptnumber', title: '收款单号'}
            ,{field:'nickname', title: '核销人'}
            ,{field:'odverifcomment', title: '备注'}
            ,{field:'', title: '操作',toolbar: '#hxsetting'}
          ]],
        page: true,
        done: function(res, curr, count){
        }
        });
        hxd = false; //防止核销单多次加载 
    }
  });

  // 新增核销单
  $('.btnhxadd').on('click',function(e){
    var sclayer = layer.open({
      type: 1,
      title:'新增核销单',
      closeBtn: 1, //不显示关闭按钮
      anim: 2,
      area: ['500px', '480px'],
      shadeClose: false, //开启遮罩关闭
      offset: '20px',
      // maxmin:1,
      content: $('#hxdpanl'),
      success: function(layero, index){
      }
    });
    form.on('submit(addhxd)', function(data){
      data.field.odverifmoney = parseInt(data.field.odverifmoney);
      data.field.odveriforder = parseInt(data.field.odveriforder);
      data.field.odverifreceipt = parseInt(data.field.odverifreceipt);
        admin.req({
          url: setter.standardapi
            ,data: {
               model: 'eos_order_verificationsheet',
               api: 'create',
               jsonparam: JSON.stringify(data.field)
              }      
            ,success: function(res){
              if(res.errorCode === 0){
              layer.close(sclayer);
              table.reload('hxdtb', {});
              }else{
                layer.msg('新建核销单失败', {
                  offset: '15px'
                  ,icon: 5
                  ,time: 1000
                });  
              }
          }
            ,error: function(res){
              //登入成功的提示与跳转
              layer.msg('新建核销单失败', {
                offset: '15px'
                ,icon: 5
                ,time: 1000
              });
            }
          });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
  });
  // 删除核销单
  $('.btnhxdelete').on('click',function(){
      var checkStatus = table.checkStatus('hxdtb');
      var checkData = checkStatus.data;
      var data=[];
      if(checkData.length === 0){
        layer.msg('请选择要删除的核销单!');
        return;
      }
    for (let i = 0; i < checkData.length; i++) {
      var hxd = {
      model:'eos_order_verificationsheet',
      api:'delete',
      condition: {
          simple: {
            item1: {
              column: 'uid',
              cop: '=',
              value: checkData[i].uid
            }
          }
        }
      }
      data.push(hxd);
    }
    layer.confirm('确认删除选定核销单?', function(index){
      admin.req({
          url: setter.batchapi
            ,data: {
              jsonparam: JSON.stringify(data)
            }      
            ,success: function(res){
              if(res.errorCode === 0){
              table.reload('hxdtb', {}); // 重载核销单
              }else{
                layer.msg('删除核销单失败', {
                  offset: '15px'
                  ,icon: 5
                  ,time: 1000
                });  
              }
          }
            ,error: function(res){
              layer.msg('删除核销单失败', {
                offset: '15px'
                ,icon: 5
                ,time: 1000
              });
            }
          });
        layer.close(index);
    });
  });

  // 新增收款单
  $('.btnskadd').on('click',function(e){
    var sclayer = layer.open({
      type: 1,
      title:'新增收款单',
      closeBtn: 1, //不显示关闭按钮
      anim: 2,
      area: ['500px', '480px'],
      shadeClose: false, //开启遮罩关闭
      offset: '20px',
      // maxmin:1,
      content: $('#skdpanl'),
      success: function(layero, index){
      }
    });
    form.on('submit(addskd)', function(data){
      data.field.rcptmoney = parseInt(data.field.rcptmoney);
      data.field.rcpttype = parseInt(data.field.rcpttype);
      data.field.rcptcustomer = parseInt(data.field.rcptcustomer);
        admin.req({
          url: setter.standardapi
            ,data: {
               model: 'eos_receipt',
               api: 'create',
               jsonparam: JSON.stringify(data.field)
              }      
            ,success: function(res){
              if(res.errorCode === 0){
              layer.close(sclayer);
              table.reload('skdtb', {
                // url: '/api/table/search'
                // ,where: {} //设定异步数据接口的额外参数
                //,height: 300
              });
              }else{
                layer.msg('新建收款单失败', {
                  offset: '15px'
                  ,icon: 5
                  ,time: 1000
                });  
              }
          }
            ,error: function(res){
              //登入成功的提示与跳转
              layer.msg('新建收款单失败', {
                offset: '15px'
                ,icon: 5
                ,time: 1000
              });
            }
          });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
  });
  // 删除收款单
  $('.btnskdelete').on('click',function(){
      var checkStatus = table.checkStatus('skdtb');
      var checkData = checkStatus.data;
      var data=[];
      if(checkData.length === 0){
        layer.msg('请选择要删除的收款单!');
        return;
      }
    for (let i = 0; i < checkData.length; i++) {
      if(checkData[i].rcptstate === 1){
        layer.msg('选中的收款单已审核不能删除!'); 
        return;
      }
      var skd = {
      model:'eos_receipt',
      api:'delete',
      condition: {
          simple: {
            item1: {
              column: 'uid',
              cop: '=',
              value: checkData[i].uid
            }
          }
        }
      }
      data.push(skd);
    }
    layer.confirm('确认删除选定收款单?', function(index){
      admin.req({
          url: setter.batchapi
            ,data: {
              jsonparam: JSON.stringify(data)
            }      
            ,success: function(res){
              if(res.errorCode === 0){
              table.reload('skdtb', {
                // url: '/api/table/search'
                // ,where: {} //设定异步数据接口的额外参数
                //,height: 300
              });
              }else{
                layer.msg('删除收款单失败', {
                  offset: '15px'
                  ,icon: 5
                  ,time: 1000
                });  
              }
          }
            ,error: function(res){
              //登入成功的提示与跳转
              layer.msg('删除收款单失败', {
                offset: '15px'
                ,icon: 5
                ,time: 1000
              });
            }
          });
        // return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        layer.close(index);
    });
  });

  // 选择收款客户
$('.btnaddcus').on('click',function(e){
    var cuslayer = layer.open({
      type: 1,
      title:'选择客户',
      // skin: 'layui-layer-demo', //样式类名
      closeBtn: 1, //不显示关闭按钮
      anim: 2,
      area: ['500px', '480px'],
      shadeClose: true, //开启遮罩关闭
      offset: '20px',
      maxmin:1,
      content: $('#plancus')
    });
    var empTable = table.render({
      elem: '#custb',
      url: setter.layuiqueryapi,
      method:'post',
      height:357,
      where: 	{jsonparam: JSON.stringify([{
            solve_name_conflict: false,
        		model: 'crm_customer',
        		api: 'read',
	        	columns: ['count(uid) AS total'],
	        },{
        		model: 'crm_customer',
            api: 'read'
	        }])},
          cols: [[
            {type:'radio'}
            ,{field:'custmname', title: '公司名称'}
            ,{field:'custmcontact', title: '联系人', sort: true}
            ]],
          page: true,
          done: function(res, curr, count){
          
          }
    });
    e.preventDefault();
    $('.cusenter').off('click').on('click',function(){
      var checkStatus = table.checkStatus('custb')
      ,data = checkStatus.data;
      if(data.length < 1){
        layer.msg('您还未选择客户');
        return;
      } 
      $('.cusname').val(data[0].custmname);
      $('.cusuid').val(data[0].uid);
      layer.close(cuslayer);
    })
    $('.cuscancel').on('click',function(){
      layer.close(cuslayer);
    })
    return false;
  });
  // 选择订单
$('.btnaddorder').on('click',function(e){
    var cuslayer = layer.open({
      type: 1,
      title:'选择订单',
      // skin: 'layui-layer-demo', //样式类名
      closeBtn: 1, //不显示关闭按钮
      anim: 2,
      area: ['500px', '480px'],
      shadeClose: true, //开启遮罩关闭
      offset: '20px',
      maxmin:1,
      content: $('#plancus')
    });
    var empTable = table.render({
      elem: '#custb',
      url: setter.layuiqueryapi,
      method:'post',
      height:357,
      where: 	{jsonparam: JSON.stringify([{
            solve_name_conflict: false,
        		model: 'eos_order',
        		api: 'read',
	        	columns: ['count(uid) AS total'],
	        },{
        		model: 'eos_order',
            api: 'read',
            columns:['*', 'odcustomer$$crm_customer.custmname AS custmname'],
            association: { 
              odcustomer:{}
            },
	        }])},
          cols: [[
            {type:'radio'}
            ,{field:'odnumber', title: '订单号'}
            ,{field:'custmname', title: '客户'}
            ,{field:'odreceipt', title: '实收金额', sort: true}
            ,{field:'oddatetime', title: '订货时间', sort: true}
            ,{field:'odstate', title: '状态'}
            ,{field:'odpayment', title: '付款状态'}
            ]],
          page: true,
          done: function(res, curr, count){
          
          }
    });
    e.preventDefault();
    $('.cusenter').off('click').on('click',function(){
      var checkStatus = table.checkStatus('custb')
      ,data = checkStatus.data;
      if(data.length < 1){
        layer.msg('您还未选择订单');
        return;
      } 
      $('.odveriforder').val(data[0].odnumber);
      $('.odveriforderid').val(data[0].uid);
      layer.close(cuslayer);
    })
    $('.cuscancel').on('click',function(){
      layer.close(cuslayer);
    })
    return false;
  });
  // 选择收款单
$('.btnaddskd').on('click',function(e){
    var cuslayer = layer.open({
      type: 1,
      title:'选择收款单',
      // skin: 'layui-layer-demo', //样式类名
      closeBtn: 1, //不显示关闭按钮
      anim: 2,
      area: ['500px', '480px'],
      shadeClose: true, //开启遮罩关闭
      offset: '20px',
      maxmin:1,
      content: $('#plancus')
    });
    var empTable = table.render({
      elem: '#custb',
      url: setter.layuiqueryapi,
      method:'post',
      height:357,
      where: 	{jsonparam: JSON.stringify([{
            solve_name_conflict: false,
        		model: 'eos_receipt',
        		api: 'read',
	        	columns: ['count(uid) AS total'],
	        },{
        		model: 'eos_receipt',
            api: 'read',
            columns:['*', 'rcptcustomer$$crm_customer.custmname AS custmname'],
            association: { 
              rcptcustomer:{}
            },
	        }])},
          cols: [[
            {type:'radio'}
            ,{field:'rcptnumber', title: '收款单号'}
            ,{field:'custmname', title: '客户'}
            ,{field:'rcptmoney', title: '收款金额'}
            ,{field:'rcptdatetime', title: '收款时间', sort: true}
            ]],
          page: true,
          done: function(res, curr, count){
          
          }
    });
    e.preventDefault();
    $('.cusenter').off('click').on('click',function(){
      var checkStatus = table.checkStatus('custb')
      ,data = checkStatus.data;
      if(data.length < 1){
        layer.msg('您还未选择收款单');
        return;
      } 
      $('.odverifreceipt').val(data[0].rcptnumber);
      $('.odverifreceiptid').val(data[0].uid);
      layer.close(cuslayer);
    })
    $('.cuscancel').on('click',function(){
      layer.close(cuslayer);
    })
    return false;
  });
    // 修改收款单 审核收款单
    table.on('tool(skdtb)', function(obj){
      if(obj.data.rcptstate){
        return;
      }
      if(obj.event === 'prover'){
        layer.confirm('确认同意收款么?', function(index){
          admin.req({
          url: setter.standardapi //实际使用请改成服务端真实接口
          ,data: {
            model:'eos_receipt',
            api:'update',
            jsonparam: JSON.stringify({
              entity:{rcptstate:1},
              condition: {
                simple: {
                  item1: {
                    column: 'uid',
                    cop: '=',
                    value: obj.data.uid
                  }
                }
              }
            })
          }  
          ,success: function(res){
            if(res.errorCode === 0){
              obj.update({
                rcptstate: 1
              });
              $('.layui-table-click a.layui-btn').addClass('layui-btn-disabled');
            }else{
              layer.msg('审核失败', {
              offset: '15px'
              ,icon: 5
              ,time: 1000
            });
            }
          }
          ,error: function(res){
            layer.msg('审核失败', {
              offset: '15px'
              ,icon: 5
              ,time: 1000
            });
          }
        });
        layer.close(index);
        });
      }else if(obj.event === 'edit'){
        var sclayer = layer.open({
          type: 1,
          title:'修改收款单',
          closeBtn: 1, //不显示关闭按钮
          anim: 2,
          area: ['500px', '480px'],
          shadeClose: false, //开启遮罩关闭
          offset: '20px',
          // maxmin:1,
          content: $('#skdpanl'),
          success: function(layero, index){
          }
        });
        form.val("skdform", {
          "rcptcustomer": obj.data.rcptcustomer
          ,"rcptmoney": obj.data.rcptmoney
          ,"rcpttype": obj.data.rcpttype
          ,"rcptcomment": obj.data.rcptcomment
        })
        $('.cusname').val(obj.data.custmname);
    form.on('submit(addskd)', function(data){
      data.field.rcptmoney = parseInt(data.field.rcptmoney);
      data.field.rcpttype = parseInt(data.field.rcpttype);
      data.field.rcptcustomer = parseInt(data.field.rcptcustomer);
        admin.req({
          url: setter.standardapi
            ,data:{
              model:'eos_receipt',
              api:'update',
              jsonparam: JSON.stringify({
                entity:data.field,
                condition: {
                  simple: {
                    item1: {
                      column: 'uid',
                      cop: '=',
                      value: obj.data.uid
                    }
                  }
                }
              })
            }  
            ,success: function(res){
              if(res.errorCode === 0){
              layer.close(sclayer);
              table.reload('skdtb', {
                // url: '/api/table/search'
                // ,where: {} //设定异步数据接口的额外参数
                //,height: 300
              });
              }else{
                layer.msg('修改收款单失败', {
                  offset: '15px'
                  ,icon: 5
                  ,time: 1000
                });  
              }
          }
            ,error: function(res){
              //登入成功的提示与跳转
              layer.msg('修改收款单失败', {
                offset: '15px'
                ,icon: 5
                ,time: 1000
              });
            }
          });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
      }
    });
   
  });
      </script>  
      </body>
  </html>