<!DOCTYPE html>
<!-- 商品管理 页面 -->
<html>
    <head>
        <meta charset="UTF-8">
        <title>商品管理-快销宝-深圳市沟通科技有限公司</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
        <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="../lib/css/layui.css">
        <link rel="stylesheet" href="../css/goods.min.css">
        <style>
        .layui-upload-img{width: 92px;height: 92px;margin: 0 10px 10px 0;}
        </style>
    </head>
    <body style="overflow-y: scroll;">
        <div class="layui-tab layui-tab-brief" lay-filter="task" style="margin: 0px;">
          <ul class="layui-tab-title">
            <li class="layui-this">全部商品</li>
          </ul>
          <div class="layui-tab-content" style="padding: 0px;">
            <div class="layui-tab-item layui-show">
                <div class="layui-row" style="position: absolute;top: 5px;right: 5px;">
                  <div class="layui-inline">
                    <form class="layui-form" action="">
                      <div class="layui-input-inline">
                          <div class="layui-input-inline">
                              <div class="layui-input-inline" style="margin-right: -5px;">
                                <input type="text" style="height: 30px;" name="number" placeholder="搜索商品名称" autocomplete="off" class="layui-input">
                              </div>
                              <div class="layui-btn-group">
                                <button class="layui-btn layui-btn-primary layui-btn-sm "><i class="layui-icon">&#xe615;</i> </button>
                              </div>
                            </div>
                      </div>
                  </form>
                </div>
                  <div class="layui-btn-group">
                    <button class="layui-btn layui-btn-sm btnsc">添加</button>
                    <button class="layui-btn layui-btn-sm btnstyle">上架</button>
                    <button class="layui-btn layui-btn-sm btnstyle">下架</button>
                    <button class="layui-btn layui-btn-sm btnstyle">删除</button>
                  </div>
              </div>
              <!-- 全部文档 -->
              <table class="layui-table" id="qbtb" lay-filter="qbtb"></table>
            </div>
          </div>
        </div>    
    <script type="text/html" id="img">
      {{# var path = layui.setter.root + layui.admin.base64decode(d.resourcepath)}}
        <a><img style="max-width: 35px;" src={{ path }}></a>
      </script>
    <script type="text/html" id="setting">
        <a class="layui-btn layui-btn-xs" style="background-color:#FF5722" lay-event="delete">修改</a>
      </script>
      <script type="text/html" id="switchTpl">
        <!-- 这里的 checked 的状态只是演示 -->
        <input type="checkbox" name="gozonshelf" value="{{d.gozonshelf}}" lay-skin="switch"  lay-filter="gozonshelf" {{ d.gozonshelf == 1 ? 'checked' : '' }}>
      </script>
  
    <script src="../lib/layui.js"></script>
    <!-- <script src="../js/attendance.js"></script> -->
     
    <script>
    layui.config({
    base: '../compontents/' //静态资源所在路径
  }).extend({
    admin: 'admin' //主入口模块
  }).use(['element','form','table','layer','admin','laydate','upload'], function(){
  var $ = layui.jquery
  ,element = layui.element
  ,form = layui.form
  ,setter = layui.setter
  ,admin = layui.admin
  ,layer = layui.layer
  ,table = layui.table
  ,upload = layui.upload
//   ,count = 0;
  var list = true // 列表/平铺
    ,alltb = false; //首次加载数据

  // 加载全部文档
  var splan = table.render({
      elem: '#qbtb',
      url: setter.layuiqueryapi,
      method:'post',
      where: 	{jsonparam: JSON.stringify([{
            solve_name_conflict: false,
        		model: 'eos_goods',
        		api: 'read',
	        	columns: ['count(uid) AS total'],
	        },{
        		model: 'eos_goods',
            api: 'read',
            columns:['*', 'gozbasunit$$eos_goodsunit.gozunitname AS gozunitname','gozbrand$$eos_goodsbrand.gozbrandname AS gozbrandname','gozpictures$$bas_resource.resourcepath AS resourcepath'],
            association: {  	
              gozbasunit: {},
              gozbrand:{},
              gozpictures:{}
            },
            order: [ 
             {
              column: "uid",
              order: "DESC", //可选（默认为ASC）
             }
            ],
            // condition:{"simple":{"item1":{"column":"approver","cop":"=","value":admin.iam()}}}
          }])
        },
      cols: [[
          {type:'checkbox'}
          ,{field:'resourcepath', title: '商品',templet:'#img'}
          ,{field:'gozname', title: '名称'}
          ,{field:'gozbrandname', title: '品牌', sort: true}
          ,{field:'gozunitname', title: '单位'}
          ,{field:'gozonshelf', title: '是否上架',templet:'#switchTpl'}
          ,{field:'', title: '操作',toolbar: '#setting'}
        ]],
      page: true,
      done: function(res, curr, count){
        sPtb = true;
      }
      });
  // 删除文件
  table.on('tool(wdtb)', function(obj){
    if(obj.event === 'delete'){
      layer.confirm('真的删除么', function(index){
          admin.req({
          url: setter.standardapi //实际使用请改成服务端真实接口
          ,data: {
            model:'oa_doc',
            api:'delete',
            jsonparam: JSON.stringify({
              condition: {
                simple: {
                  item1: {
                    column: 'uid',
                    cop: '=',
                    value: obj.data.uid
                  }
                }
              }
            })
          }  
          ,success: function(res){
            if(res.errorCode === 0){
              obj.del();
            }
          }
          ,error: function(res){
            layer.msg('删除失败', {
              offset: '15px'
              ,icon: 5
              ,time: 1000
            });
          }
        });
        layer.close(index);
        });
    }
  });

 //监听上架下架
 form.on('switch(gozonshelf)', function(obj){
    layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
  });

// 切换文件显示样式  平铺/列表
  $('.btnstyle').on('click',function(e){
      if(list){
        $('.layui-icon-app').removeClass('layui-icon-app').addClass('layui-icon-template');
        list = false;  
      }else{
        $('.layui-icon-template').removeClass('layui-icon-template').addClass('layui-icon-app');
        list = true;  
      }
  });
  
 
  
 
   
});
    </script>  
    </body>
</html>